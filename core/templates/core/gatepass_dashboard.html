update this code {% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/gatepass.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}

<div class="container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h2>Gatepass Dashboard</h2>
    </div>

    <!-- Summary Status Cards -->
    <div class="summary-cards" style="margin-bottom:20px;">
        <div class="card pending">
            <i class="fas fa-clock"></i>
            <h3>Pending</h3>
            <p>{{ pending_count }}</p>
        </div>
        <div class="card approved">
            <i class="fas fa-check-circle"></i>
            <h3>Approved</h3>
            <p>{{ approved_count }}</p>
        </div>
        <div class="card rejected">
            <i class="fas fa-times-circle"></i>
            <h3>Rejected</h3>
            <p>{{ rejected_count }}</p>
        </div>
    </div>

    <!-- Request Gatepass Button -->
    <a href="{% url 'request_dashboard' %}" class="btn-request" style="margin-bottom: 20px;">
        <i class="fas fa-plus-circle"></i> Request New Gatepass
    </a>

    <!-- Gatepass List Table -->
    <div class="gatepass-list-section">
        <h3>My Gatepass Requests</h3>
        <table class="gatepass-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Reason</th>
                    <th>Faculty Status</th>
                    <th>HOD Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if gatepasses %}
                    {% for gp in gatepasses %}
                        <tr>
                            <td>{{ gp.date }}</td>
                            <td>{{ gp.time }}</td>
                            <td>{{ gp.reason }}</td>
                            <td><span class="status-badge status-{{ gp.faculty_status|lower }}">{{ gp.faculty_status }}</span></td>
                            <td><span class="status-badge status-{{ gp.hod_status|lower }}">{{ gp.hod_status }}</span></td>
                            <td>
                                {% if gp.hod_status == 'Approved' %}
                                    <a href="{% url 'view_gatepass' gp.id %}" class="btn-view">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <button class="btn-qr" data-qr-url="{% url 'view_gatepass_qr' gp.id %}" title="View QR Code" style="margin-left:10px; background:none; border:none; cursor:pointer; color:#28a745;">
                                        <i class="fas fa-qrcode fa-lg"></i>
                                    </button>
                                {% else %}
                                    <span>-</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="no-requests">No gatepass requests yet.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Chart Section: By Reason -->
    <div class="chart-section" style="margin-top:30px;">
        <h3>Gatepass Requests by Reason</h3>
        <canvas id="reasonChart" width="400" height="200"></canvas>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="qr-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center;">
        <div style="background:#fff; padding:20px; border-radius:10px; position:relative; max-width:300px; text-align:center;">
            <span id="qrClose" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px;">&times;</span>
            <h3>Gatepass QR Code</h3>
            <img id="qrImage" src="" alt="QR Code" style="width:200px; height:200px; margin-top:10px;">
        </div>
    </div>

</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart: Reason Chart
    const chartLabels = JSON.parse('{{ chart_labels|safe }}');
    const chartData = JSON.parse('{{ chart_data|safe }}');
    const backgroundColors = [
        'rgba(54, 162, 235, 0.8)',
        'rgba(255, 99, 132, 0.8)',
        'rgba(75, 192, 192, 0.8)'
    ];
    const ctx = document.getElementById('reasonChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartLabels,
            datasets: [{
                label: 'Number of Requests',
                data: chartData,
                backgroundColor: backgroundColors,
                borderColor: backgroundColors.map(color => color.replace('0.8', '1')),
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Number of Gatepasses' } },
                x: { title: { display: true, text: 'Reason' } }
            },
            plugins: { legend: { display: false } }
        }
    });

    // QR Code Modal
    const qrModal = document.getElementById('qrModal');
    const qrImage = document.getElementById('qrImage');
    const qrClose = document.getElementById('qrClose');

    document.querySelectorAll('.btn-qr').forEach(btn => {
        btn.addEventListener('click', function() {
            qrImage.src = this.getAttribute('data-qr-url');
            qrModal.style.display = 'flex';
        });
    });

    qrClose.addEventListener('click', function() {
        qrModal.style.display = 'none';
        qrImage.src = '';
    });
    
    window.addEventListener('click', function(e) {
        if(e.target == qrModal) {
            qrModal.style.display = 'none';
            qrImage.src = '';
        }
    });
});
</script>

{% endblock %}
